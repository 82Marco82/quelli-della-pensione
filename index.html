<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Quelli della Pensione</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:#0f172a;color:#e5e7eb}
    .container{max-width:420px;margin:auto;padding:16px}
    h1{text-align:center;font-weight:900;letter-spacing:1px;margin:10px 0 4px}
    .subtitle{text-align:center;opacity:.85;margin-bottom:16px}
    .card{background:#020617;border-radius:18px;padding:14px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    img{width:100%;border-radius:14px;margin-bottom:8px}
    .row{margin:8px 0}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:13px;font-weight:700;margin-left:8px}
    .ok{background:#16a34a}
    .wait{background:#f59e0b;color:#111827}
    .info{background:#334155}
    iframe{width:100%;height:260px;border:0;border-radius:14px;margin-top:10px}
    .admin{text-align:center;margin-top:12px}
    .admin a{color:#60a5fa;text-decoration:none;font-weight:700}
    .error{background:#7f1d1d;padding:10px;border-radius:12px;margin-top:10px;font-size:14px}
    .debug{background:#0b1224;border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:12px;font-size:13px;opacity:.95}
  </style>
</head>

<body>
  <div class="container">
    <h1>QUELLI DELLA PENSIONE</h1>
    <div class="subtitle">Ogni maledetto gioved√¨ ‚Ä¢ Ore 21 ‚Ä¢ Campo a 6 Aradeo</div>

    <div class="card">
      <img src="foto.jpg" alt="Quelli della Pensione">
    </div>

    <div id="debugBox" class="card debug">Verifica script‚Ä¶</div>

    <div id="content" class="card">Caricamento‚Ä¶</div>

    <div class="admin">
      <a href="admin.html">Area Admin</a>
    </div>
  </div>

  <!-- 1) CONFIG: deve esistere in repo nella stessa cartella -->
  <script src="./config.js"></script>

  <!-- 2) Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const debugBox = document.getElementById("debugBox");
    const content = document.getElementById("content");

    function debug(msg){
      debugBox.innerHTML = msg;
    }

    // ‚úÖ Controllo config.js
    if (!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY) {
      debug("‚ùå config.js non caricato (o valori mancanti). Controlla che esista ./config.js e contenga SUPABASE_URL e SUPABASE_ANON_KEY.");
      content.innerHTML = "<div class='error'>Errore: config.js non caricato</div>";
      throw new Error("config.js missing");
    }

    // ‚úÖ Controllo supabase lib
    // Con questo CDN l‚Äôoggetto corretto √® spesso window.supabase
    if (!window.supabase || !window.supabase.createClient) {
      debug("‚ùå Supabase CDN non caricato. (window.supabase non trovato)");
      content.innerHTML = "<div class='error'>Errore: Supabase CDN non caricato</div>";
      throw new Error("supabase CDN missing");
    }

    debug("‚úÖ Supabase OK");

    const client = window.supabase.createClient(
      window.SUPABASE_URL,
      window.SUPABASE_ANON_KEY
    );

    async function loadMatch() {
      try {
        const { data, error } = await client
          .from("matches")
          .select("*")
          .order("match_date", { ascending: false })
          .limit(1);

        if (error) throw error;

        if (!data || data.length === 0) {
          content.innerHTML = "<div class='row'>Nessuna partita creata</div>";
          return;
        }

        const m = data[0];

        const teamA = m.team_a || "-";
        const teamB = m.team_b || "-";

        let risultatoHTML = "";
        if (m.goals_a == null || m.goals_b == null) {
          risultatoHTML = `
            <div class="row">
              üèÅ <strong>Risultato:</strong> da giocare
              <span class="badge wait">DA GIOCARE</span>
            </div>`;
        } else {
          risultatoHTML = `
            <div class="row">
              üèÅ <strong>Risultato:</strong> ${m.goals_a} - ${m.goals_b}
              <span class="badge ok">GIOCATA</span>
            </div>`;
        }

        content.innerHTML = `
          <div class="row">üìÖ <strong>${m.match_date}</strong></div>
          <div class="row">üü° <strong>Squadra A:</strong> ${teamA}</div>
          <div class="row">üî¥ <strong>Squadra B:</strong> ${teamB}</div>
          ${risultatoHTML}

          <iframe
            src="https://maps.google.com/maps?q=Campo%20Sportivo%20Aradeo&t=&z=15&ie=UTF8&iwloc=&output=embed">
          </iframe>
        `;
      } catch (err) {
        content.innerHTML = `
          <div class="error">
            Errore caricamento partita:<br>
            ${err.message}
          </div>`;
      }
    }

    loadMatch();
  </script>
</body>
</html>
