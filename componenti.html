<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Componenti ‚Ä¢ Quelli della pensione</title>

  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f4f6f8;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow:0 6px 20px rgba(0,0,0,.08);
      --pill:#eeeeee;
      --logo1:#111;
      --logo2:#333;
      --btn:#111;

      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --chipBg:rgba(0,0,0,.04);
    }
    body.dark{
      --bg:#0f1115;
      --card:#171a21;
      --text:#e5e7eb;
      --muted:#a1a1aa;
      --border:#2a2f3a;
      --shadow:0 10px 28px rgba(0,0,0,.45);
      --pill:#222631;
      --logo1:#0b0e14;
      --logo2:#2a3242;
      --btn:#0b0e14;
      --chipBg:rgba(255,255,255,.04);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui;
      background:var(--bg);
      color:var(--text);
      transition:.2s;
    }
    .wrap{max-width:980px;margin:auto;padding:16px}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:var(--shadow);
      margin:12px 0;
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .brand{display:flex; align-items:center; gap:12px;}
    .logo{
      width:56px;height:56px;border-radius:999px;
      background:linear-gradient(135deg,var(--logo1),var(--logo2));
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-family:'Bebas Neue';font-size:26px;
      letter-spacing:2px;
      box-shadow:var(--shadow);
      flex:0 0 auto;
    }
    .titleWrap{line-height:1.1}
    .title{
      font-family:'Bebas Neue';
      letter-spacing:2px;
      font-size:44px;
      margin:0;
      text-transform:uppercase;
    }
    .subtitle{color:var(--muted);font-size:14px;margin-top:2px}

    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .spacer{flex:1}
    .muted{color:var(--muted)}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:var(--pill);
      border-radius:999px;
      padding:8px 12px;
      font-weight:900;
      border:1px solid var(--border);
      white-space:nowrap;
      max-width:100%;
    }
    .btn{
      border:0;
      background:var(--btn);
      color:#fff;
      padding:12px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn.ghost{
      background:transparent;
      color:var(--text);
      border:1px solid var(--border);
    }
    .btn.small{padding:10px 12px; border-radius:12px; font-size:14px}
    .btn.ok{background:var(--ok)}
    .btn.warn{background:var(--warn); color:#111}
    .btn.danger{background:var(--bad)}

    .input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      font-family:inherit;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical}

    .grid{
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:12px;
    }
    @media(max-width:980px){ .grid{grid-template-columns:repeat(3, 1fr)} }
    @media(max-width:760px){ .grid{grid-template-columns:repeat(2, 1fr)} }
    @media(max-width:480px){ .grid{grid-template-columns:1fr} }

    .pCard{
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      background:var(--card);
      box-shadow:var(--shadow);
      cursor:pointer;
      transition:transform .12s ease;
    }
    .pCard:active{transform:scale(.99)}
    .pTop{
      padding:14px 14px 10px;
      display:flex;
      gap:12px;
      align-items:center;
    }
    .avatar{
      width:58px;height:58px;border-radius:999px;
      border:1px solid var(--border);
      object-fit:cover;
      background:#000;
      flex:0 0 auto;
    }
    .pName{
      font-weight:900;
      line-height:1.1;
    }
    .pMeta{
      margin-top:4px;
      color:var(--muted);
      font-weight:800;
      font-size:12px;
      line-height:1.2;
    }
    .gkBadge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--chipBg);
      font-weight:900;
      font-size:12px;
    }

    .stats{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding:0 14px 14px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--chipBg);
      font-weight:900;
      font-size:12px;
    }

    .nav{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:14px;
    }
    .nav a{
      color:var(--text);
      text-decoration:none;
      font-weight:800;
    }

    .fab{
      position:fixed;
      right:16px;bottom:16px;
      width:54px;height:54px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--card);
      box-shadow:var(--shadow);
      cursor:pointer;
      font-size:22px;
    }

    /* Modal */
    .modalBack{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modal{
      width:min(720px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .mHead{
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--border);
    }
    .mTitle{
      font-weight:900;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .mBody{padding:14px}
    .mTop{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
    }
    .avatarBig{
      width:110px;height:110px;border-radius:999px;
      border:1px solid var(--border);
      object-fit:cover;
      background:#000;
    }
    .mInfo{flex:1}
    .mName{font-weight:900;font-size:18px}
    .mSub{margin-top:6px;color:var(--muted);font-weight:800}
    .mStats{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .divider{height:1px;background:var(--border); margin:12px 0}
    .adminBox{
      display:none;
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      background:var(--chipBg);
      margin-top:12px;
    }
    .adminBox .row{margin-top:10px}
    .toast{
      display:none;
      margin-top:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(22,163,74,.10);
      color:var(--text);
      font-weight:800;
    }
    .toast.show{display:block}
    .toast.bad{background:rgba(239,68,68,.10)}
    .toast.warn{background:rgba(245,158,11,.12)}
  </style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div class="brand">
      <div class="logo">QDP</div>
      <div class="titleWrap">
        <h1 class="title">COMPONENTI</h1>
        <div class="subtitle">Avatar ‚Ä¢ Ruoli ‚Ä¢ Presenze ‚Ä¢ Gol ‚Ä¢ MVP</div>
      </div>
    </div>

    <div class="row">
      <a class="btn ghost" href="index.html">‚¨ÖÔ∏è Home</a>
      <button id="adminBtn" class="btn small warn" type="button">üîê Admin: OFF</button>
      <button id="themeToggle" class="btn small ghost" type="button">üåô</button>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <input id="searchInput" class="input" type="text" placeholder="Cerca giocatore... (nome)">
      <label class="pill" style="gap:10px">
        üîΩ Ordina:
        <select id="sortSelect" style="width:auto; padding:8px 10px; border-radius:12px">
          <option value="name">Nome</option>
          <option value="apps">Presenze</option>
          <option value="goals">Gol</option>
          <option value="mvps">MVP</option>
        </select>
      </label>
      <div class="spacer"></div>
      <div id="countPill" class="pill">üë• 0 giocatori</div>
    </div>

    <div id="adminHint" class="pill" style="display:none; margin-top:10px; white-space:normal">
      ‚úÖ Admin attivo (puoi modificare descrizione + presenze/gol/mvp)
    </div>

    <div id="toast" class="toast"></div>
  </div>

  <div class="card">
    <div class="row">
      <div style="font-weight:900">üë• Lista giocatori</div>
      <div class="spacer"></div>
      <div class="muted" style="font-size:13px;font-weight:800">Clicca un giocatore per aprire la scheda.</div>
    </div>
    <div id="grid" class="grid" style="margin-top:12px"></div>
  </div>

  <!-- NAV (come index) -->
  <div class="card nav muted">
    <a href="storico.html">üìö Storico</a>
    <a href="marcatori.html">‚öΩ Marcatori</a>
    <a href="mvp.html">üèÜ Vota MVP</a>
    <a href="foto.html">üì∏ Foto</a>
    <a href="componenti.html">üë• Componenti</a>
    <a href="admin.html">üîê Admin</a>
  </div>

</div>

<button id="themeToggleFab" class="fab">üåô</button>

<!-- MODAL -->
<div id="modalBack" class="modalBack">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="mHead">
      <div class="mTitle" id="mTitle">Giocatore</div>
      <button id="btnClose" class="btn small ghost" type="button">‚úñÔ∏è</button>
    </div>
    <div class="mBody">
      <div class="mTop">
        <img id="mAvatar" class="avatarBig" src="" alt="avatar">
        <div class="mInfo">
          <div id="mName" class="mName">‚Äî</div>
          <div id="mSub" class="mSub">‚Äî</div>
          <div id="mStats" class="mStats"></div>
        </div>
      </div>

      <div class="divider"></div>

      <div style="font-weight:900">üìù Descrizione</div>
      <div id="mBio" class="muted" style="margin-top:8px; font-weight:800; white-space:pre-wrap">‚Äî</div>

      <div id="adminBox" class="adminBox">
        <div style="font-weight:900">üîß Modifica (solo Admin)</div>

        <div class="row">
          <label class="muted" style="font-weight:900; font-size:12px">Presenze</label>
          <input id="inApps" class="input" type="number" min="0" step="1" placeholder="Presenze">
        </div>

        <div class="row">
          <label class="muted" style="font-weight:900; font-size:12px">Gol</label>
          <input id="inGoals" class="input" type="number" min="0" step="1" placeholder="Gol">
        </div>

        <div class="row">
          <label class="muted" style="font-weight:900; font-size:12px">MVP</label>
          <input id="inMvps" class="input" type="number" min="0" step="1" placeholder="MVP">
        </div>

        <div class="row">
          <label class="muted" style="font-weight:900; font-size:12px">Descrizione</label>
          <textarea id="inBio" class="input" maxlength="300" placeholder="Scrivi una breve descrizione (max 300)"></textarea>
        </div>

        <div class="row">
          <button id="btnSave" class="btn ok" type="button">üíæ Salva</button>
          <button id="btnReset" class="btn ghost" type="button">‚Ü©Ô∏è Annulla</button>
        </div>

        <div class="muted" style="margin-top:8px; font-weight:800; font-size:12px">
          Nota: se non salva, controlla RLS su tabella <b>players</b>.
        </div>
      </div>
    </div>
  </div>
</div>

<script src="config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
/* ===== THEME ===== */
const themeBtn = document.getElementById("themeToggle");
const themeBtnFab = document.getElementById("themeToggleFab");
function setTheme(mode){
  document.body.classList.toggle("dark", mode === "dark");
  themeBtn.textContent = (mode === "dark") ? "‚òÄÔ∏è" : "üåô";
  themeBtnFab.textContent = (mode === "dark") ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("qdp_theme", mode);
}
setTheme(localStorage.getItem("qdp_theme") === "dark" ? "dark" : "light");
themeBtn.onclick = () => setTheme(document.body.classList.contains("dark") ? "light" : "dark");
themeBtnFab.onclick = () => setTheme(document.body.classList.contains("dark") ? "light" : "dark");

/* ===== SUPABASE ===== */
if(!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY){
  alert("config.js non caricato o non valido");
  throw new Error("Missing config");
}
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ===== AVATAR PATH (GitHub) =====
   Se la cartella avatars √® nella root del sito, lascia cos√¨.
*/
const AVATAR_BASE = "avatars/";
const DEFAULT_AVATAR = "default.png";

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function showToast(msg, type="ok"){
  const toast = document.getElementById("toast");
  toast.classList.remove("show","bad","warn");
  if(type==="bad") toast.classList.add("bad");
  if(type==="warn") toast.classList.add("warn");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 2200);
}

/* ===== ADMIN ===== */
const adminBtn = document.getElementById("adminBtn");
const adminHint = document.getElementById("adminHint");
let adminOn = false;

async function getSession(){
  const { data } = await client.auth.getSession();
  return data?.session || null;
}
function isAdminSession(session){ return !!(session && session.user); }

async function refreshAdminUI(){
  const session = await getSession();
  adminOn = isAdminSession(session);
  adminBtn.textContent = adminOn ? "üîê Admin: ON" : "üîê Admin: OFF";
  adminBtn.classList.toggle("warn", !adminOn);
  adminBtn.classList.toggle("ok", adminOn);
  adminHint.style.display = adminOn ? "inline-flex" : "none";

  // admin box nel modal
  const adminBox = document.getElementById("adminBox");
  adminBox.style.display = adminOn ? "block" : "none";
  return adminOn;
}

adminBtn.onclick = async () => {
  const session = await getSession();
  if(isAdminSession(session)){
    await client.auth.signOut();
    showToast("Admin disattivato.", "warn");
    await refreshAdminUI();
    return;
  }
  const email = prompt("Email admin:");
  if(!email) return;
  const password = prompt("Password admin:");
  if(!password) return;

  const { error } = await client.auth.signInWithPassword({ email, password });
  if(error){
    console.error(error);
    showToast("Login fallito.", "bad");
    return;
  }
  showToast("Admin attivo ‚úÖ");
  await refreshAdminUI();
};

/* ===== UI CONTROLS ===== */
const grid = document.getElementById("grid");
const countPill = document.getElementById("countPill");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");

/* ===== MODAL DOM ===== */
const modalBack = document.getElementById("modalBack");
const btnClose = document.getElementById("btnClose");
const mTitle = document.getElementById("mTitle");
const mAvatar = document.getElementById("mAvatar");
const mName = document.getElementById("mName");
const mSub = document.getElementById("mSub");
const mStats = document.getElementById("mStats");
const mBio = document.getElementById("mBio");

const inApps = document.getElementById("inApps");
const inGoals = document.getElementById("inGoals");
const inMvps = document.getElementById("inMvps");
const inBio = document.getElementById("inBio");
const btnSave = document.getElementById("btnSave");
const btnReset = document.getElementById("btnReset");

btnClose.onclick = closeModal;
modalBack.addEventListener("click", (e)=>{ if(e.target === modalBack) closeModal(); });
document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

function openModal(){
  modalBack.style.display = "flex";
}
function closeModal(){
  modalBack.style.display = "none";
  CURRENT_MODAL_PLAYER = null;
}

/* ===== DATA ===== */
let PLAYERS = [];
let CURRENT_MODAL_PLAYER = null;

function getAvatarUrl(p){
  const file = (p.avatar || p.avatar_file || p.avatar_path || "").trim() || DEFAULT_AVATAR;
  return AVATAR_BASE + file;
}
function safeNum(v){
  const n = Number(v);
  return Number.isFinite(n) ? n : null;
}
function statText(label, val){
  return `${label}: ${val == null ? "‚Äî" : val}`;
}

function roleLabel(p){
  // role = "gk" / "field"
  const r = String(p.role || "").toLowerCase();
  const pos = (p.position || "").trim();
  const posTxt = pos ? pos : (r === "gk" ? "Portiere" : "Giocatore");
  return posTxt;
}
function isGK(p){
  return String(p.role || "").toLowerCase() === "gk";
}

function renderCard(p){
  const avatar = getAvatarUrl(p);
  const name = (p.name || "").trim();
  const pos = roleLabel(p);

  const apps = safeNum(p.appearances);
  const goals = safeNum(p.goals);
  const mvps = safeNum(p.mvps);

  return `
    <div class="pCard" data-id="${escapeHtml(p.id)}" role="button" tabindex="0">
      <div class="pTop">
        <img class="avatar" src="${escapeHtml(avatar)}" alt="avatar"
             onerror="this.onerror=null;this.src='${escapeHtml(AVATAR_BASE + DEFAULT_AVATAR)}';">
        <div style="min-width:0">
          <div class="pName">${escapeHtml(name)}${isGK(p) ? " üß§" : ""}</div>
          <div class="pMeta">${escapeHtml(pos)}</div>
          ${isGK(p) ? `<div class="gkBadge">üß§ Portiere</div>` : ``}
        </div>
      </div>
      <div class="stats">
        <div class="chip">üéÆ ${escapeHtml(statText("Pres", apps))}</div>
        <div class="chip">‚öΩ ${escapeHtml(statText("Gol", goals))}</div>
        <div class="chip">üèÜ ${escapeHtml(statText("MVP", mvps))}</div>
      </div>
    </div>
  `;
}

function applyFiltersAndRender(){
  const q = (searchInput.value || "").trim().toLowerCase();
  const sort = sortSelect.value;

  let rows = [...PLAYERS];

  if(q){
    rows = rows.filter(p => String(p.name||"").toLowerCase().includes(q));
  }

  const num = (v)=> (Number.isFinite(Number(v)) ? Number(v) : -Infinity);

  rows.sort((a,b)=>{
    if(sort === "apps") return num(b.appearances) - num(a.appearances) || String(a.name).localeCompare(String(b.name),"it");
    if(sort === "goals") return num(b.goals) - num(a.goals) || String(a.name).localeCompare(String(b.name),"it");
    if(sort === "mvps") return num(b.mvps) - num(a.mvps) || String(a.name).localeCompare(String(b.name),"it");
    return String(a.name).localeCompare(String(b.name),"it");
  });

  countPill.textContent = `üë• ${rows.length} giocatori`;

  grid.innerHTML = rows.map(renderCard).join("") || `<div class="muted">Nessun giocatore.</div>`;

  // click cards
  [...grid.querySelectorAll(".pCard")].forEach(card=>{
    const id = card.getAttribute("data-id");
    const p = rows.find(x=>String(x.id)===String(id));
    if(!p) return;

    card.onclick = ()=>openPlayer(p);
    card.onkeydown = (e)=>{ if(e.key==="Enter" || e.key===" "){ e.preventDefault(); openPlayer(p); } };
  });
}

function fillModal(p){
  const avatar = getAvatarUrl(p);
  const name = (p.name || "").trim();
  const pos = roleLabel(p);

  const apps = safeNum(p.appearances);
  const goals = safeNum(p.goals);
  const mvps = safeNum(p.mvps);
  const bio = (p.bio || "").trim();

  mTitle.textContent = "Scheda giocatore";
  mAvatar.src = avatar;
  mAvatar.onerror = ()=>{ mAvatar.onerror=null; mAvatar.src = AVATAR_BASE + DEFAULT_AVATAR; };

  mName.textContent = name + (isGK(p) ? " üß§" : "");
  mSub.textContent = pos + (isGK(p) ? " ‚Ä¢ GK" : "");

  mStats.innerHTML = `
    <span class="chip">üéÆ Presenze: <b>${apps == null ? "‚Äî" : apps}</b></span>
    <span class="chip">‚öΩ Gol: <b>${goals == null ? "‚Äî" : goals}</b></span>
    <span class="chip">üèÜ MVP: <b>${mvps == null ? "‚Äî" : mvps}</b></span>
  `;

  mBio.textContent = bio ? bio : "‚Äî";

  // admin fields
  inApps.value = (apps == null) ? "" : String(apps);
  inGoals.value = (goals == null) ? "" : String(goals);
  inMvps.value = (mvps == null) ? "" : String(mvps);
  inBio.value = bio;

  // mostra/nasconde admin box in base a sessione
  document.getElementById("adminBox").style.display = adminOn ? "block" : "none";
}

function openPlayer(p){
  CURRENT_MODAL_PLAYER = p;
  fillModal(p);
  openModal();
}

btnReset.onclick = ()=>{
  if(!CURRENT_MODAL_PLAYER) return;
  fillModal(CURRENT_MODAL_PLAYER);
};

btnSave.onclick = async ()=>{
  try{
    if(!adminOn){
      showToast("Solo admin pu√≤ salvare.", "warn");
      return;
    }
    if(!CURRENT_MODAL_PLAYER) return;

    const apps = inApps.value === "" ? null : Math.max(0, parseInt(inApps.value, 10));
    const goals = inGoals.value === "" ? null : Math.max(0, parseInt(inGoals.value, 10));
    const mvps = inMvps.value === "" ? null : Math.max(0, parseInt(inMvps.value, 10));
    const bio = (inBio.value || "").trim().slice(0,300);

    const patch = { appearances: apps, goals: goals, mvps: mvps, bio: bio };

    const { error } = await client
      .from("players")
      .update(patch)
      .eq("id", CURRENT_MODAL_PLAYER.id);

    if(error) throw error;

    // aggiorna cache locale
    PLAYERS = PLAYERS.map(x=>{
      if(String(x.id) !== String(CURRENT_MODAL_PLAYER.id)) return x;
      return { ...x, ...patch };
    });

    // aggiorna modal
    CURRENT_MODAL_PLAYER = PLAYERS.find(x=>String(x.id)===String(CURRENT_MODAL_PLAYER.id)) || CURRENT_MODAL_PLAYER;
    fillModal(CURRENT_MODAL_PLAYER);

    // aggiorna griglia
    applyFiltersAndRender();

    showToast("Salvato ‚úÖ");
  }catch(e){
    console.error(e);
    showToast("Errore salvataggio.", "bad");
  }
};

/* ===== LOAD ===== */
async function loadPlayers(){
  // prendo anche active se esiste, cos√¨ se vuoi puoi filtrare (ora non filtro)
  const { data, error } = await client
    .from("players")
    .select("id,name,role,position,avatar,avatar_file,avatar_path,appearances,goals,mvps,bio,active")
    .order("name", { ascending:true });

  if(error){
    console.error(error);
    grid.innerHTML = `<div class="muted">Errore caricamento giocatori.</div>`;
    countPill.textContent = "üë• 0 giocatori";
    return;
  }

  PLAYERS = data || [];
  applyFiltersAndRender();
}

searchInput.addEventListener("input", applyFiltersAndRender);
sortSelect.addEventListener("change", applyFiltersAndRender);

/* INIT */
(async()=>{
  await refreshAdminUI();
  await loadPlayers();

  // se cambia sessione (login/logout), aggiorno UI admin
  client.auth.onAuthStateChange(async ()=>{
    await refreshAdminUI();
    // aggiorna modal se aperto
    if(CURRENT_MODAL_PLAYER){
      const updated = PLAYERS.find(x=>String(x.id)===String(CURRENT_MODAL_PLAYER.id)) || CURRENT_MODAL_PLAYER;
      CURRENT_MODAL_PLAYER = updated;
      fillModal(updated);
    }
  });
})();
</script>
</body>
</html>
