<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard ‚Ä¢ Quelli della pensione</title>

  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f4f6f8; --card:#ffffff; --text:#111827; --muted:#6b7280;
      --border:#e5e7eb; --shadow:0 6px 20px rgba(0,0,0,.08);
      --btn:#111; --btn2:#444; --danger:#b00020;
      --okBg:#dcfce7; --okText:#166534;
      --errBg:#ffe4e6; --errText:#9f1239;
      --chipBg:rgba(0,0,0,.04);
      --pill:#eeeeee;
    }
    body.dark{
      --bg:#0f1115; --card:#171a21; --text:#e5e7eb; --muted:#a1a1aa;
      --border:#2a2f3a; --shadow:0 10px 28px rgba(0,0,0,.45);
      --btn:#0b0e14; --btn2:#2a3242; --danger:#ff4d4d;
      --okBg:rgba(34,197,94,.15); --okText:#86efac;
      --errBg:rgba(244,63,94,.16); --errText:#fda4af;
      --chipBg:rgba(255,255,255,.04);
      --pill:#222631;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:20px auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{padding:12px 14px;border-radius:14px;border:0;background:var(--btn);color:#fff;font-weight:900;cursor:pointer}
    .btn.secondary{background:var(--btn2)}
    .btn.danger{background:var(--danger)}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .btn.full{width:100%}
    .btn.small{padding:10px 12px;border-radius:12px;font-weight:800}
    label{display:block;margin-top:12px;font-size:12px;color:var(--muted);font-weight:800}
    input,select{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:var(--text)}
    .msg{margin-top:12px;padding:12px;border-radius:12px;font-size:13px;border:1px solid var(--border);background:var(--chipBg)}
    .msg.ok{background:var(--okBg);color:var(--okText)}
    .msg.err{background:var(--errBg);color:var(--errText);font-weight:900}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h2>Dashboard ‚Äì Quelli della pensione</h2>
    <div id="msg" class="msg">Caricamento‚Ä¶</div>

    <label>Partita</label>
    <select id="matchSelect">
      <option value="">‚Äî Nuova partita ‚Äî</option>
    </select>

    <div class="row">
      <button id="btnNew" class="btn ghost small">‚ûï Nuova</button>
      <button id="btnRefresh" class="btn ghost small">üîÑ Aggiorna</button>
    </div>

    <label>Data</label>
    <input id="matchDate" type="date">

    <label>Ora</label>
    <input id="matchTime" type="time" value="21:00">

    <label>Campo</label>
    <input id="venue" type="text" value="Campo a 6 - Aradeo">

    <label>Portiere Squadra A</label>
    <input id="keeperA" type="text">

    <label>Portiere Squadra B</label>
    <input id="keeperB" type="text">

    <div class="row">
      <button id="btnSave" class="btn full">üíæ Salva partita</button>
      <button id="btnDelete" class="btn danger full">üóë Elimina partita</button>
      <button id="btnWhatsApp" class="btn ghost full">üì§ Condividi su WhatsApp</button>
    </div>
  </div>
</div>

<script src="config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const $ = id => document.getElementById(id);
let MATCHES = [];
let CURRENT = null;

function setMsg(t,k=""){ $("msg").className="msg "+k; $("msg").textContent=t; }

async function loadMatches(){
  const { data } = await client.from("matches").select("*").order("match_date",{ascending:false});
  MATCHES = data || [];
  const sel = $("matchSelect");
  sel.innerHTML = `<option value="">‚Äî Nuova partita ‚Äî</option>`;
  MATCHES.forEach(m=>{
    const o=document.createElement("option");
    o.value=m.id;
    o.textContent=`${m.match_date} ${String(m.match_time||"").slice(0,5)}`;
    sel.appendChild(o);
  });
}

function fillForm(m){
  CURRENT=m;
  $("matchDate").value=m.match_date;
  $("matchTime").value=String(m.match_time||"").slice(0,5);
  $("venue").value=m.venue||"";
  $("keeperA").value=m.keeper_a||"";
  $("keeperB").value=m.keeper_b||"";
}

$("matchSelect").onchange=()=>{
  const m=MATCHES.find(x=>x.id===$("matchSelect").value);
  if(m) fillForm(m);
};

$("btnSave").onclick=async()=>{
  const payload={
    match_date:$("matchDate").value,
    match_time:$("matchTime").value+":00",
    venue:$("venue").value,
    keeper_a:$("keeperA").value,
    keeper_b:$("keeperB").value
  };
  if(CURRENT){
    await client.from("matches").update(payload).eq("id",CURRENT.id);
    setMsg("Partita aggiornata","ok");
  }else{
    const { data }=await client.from("matches").insert([payload]).select("*").single();
    CURRENT=data;
    setMsg("Partita creata","ok");
  }
  loadMatches();
};

$("btnDelete").onclick=async()=>{
  if(!CURRENT) return;
  await client.from("matches").delete().eq("id",CURRENT.id);
  CURRENT=null;
  setMsg("Partita eliminata","ok");
  loadMatches();
};

$("btnWhatsApp").onclick=()=>{
  if(!CURRENT) return setMsg("Crea o seleziona una partita","err");
  const text =
`‚öΩ Quelli della pensione

üìÖ ${CURRENT.match_date} ore ${String(CURRENT.match_time||"").slice(0,5)}
üìç ${CURRENT.venue}

ü•Ö Squadra A: ${CURRENT.keeper_a}
ü•Ö Squadra B: ${CURRENT.keeper_b}

üëâ ${location.origin + location.pathname.replace("dashboard.html","index.html")}`;
  window.open("https://wa.me/?text="+encodeURIComponent(text),"_blank");
};

loadMatches();
</script>
</body>
</html>
