<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Marcatori ‚Ä¢ Quelli della pensione</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body{
      font-family:Inter,system-ui;
      background:#f4f6f8;
      margin:0;
      padding:20px;
    }
    .box{
      max-width:600px;
      margin:auto;
      background:#fff;
      padding:20px;
      border-radius:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.08);
    }
    h1{margin-top:0}
    .muted{color:#666;font-size:13px}
    .row{margin-top:12px}
    textarea{
      width:100%;
      min-height:100px;
      padding:12px;
      border-radius:10px;
      border:1px solid #ccc;
      font-family:Inter;
      font-size:14px;
    }
    button{
      margin-top:14px;
      padding:12px 16px;
      border-radius:12px;
      border:0;
      background:#111;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    .ok{color:#0a7a32;font-weight:700;margin-top:10px}
    .err{color:#c00;font-weight:700;margin-top:10px}
    .badge{
      display:inline-block;
      background:#eee;
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      margin-right:6px;
    }
    .nav{
      display:flex;
      justify-content:space-between;
      margin-bottom:12px;
      font-size:14px;
    }
    a{text-decoration:none;color:#0b5fff}
  </style>
</head>

<body>
<div class="box">

  <div class="nav">
    <a href="index.html">‚¨ÖÔ∏è Home</a>
    <a href="admin.html">üîê Admin</a>
  </div>

  <h1>‚öΩ Marcatori</h1>
  <div id="info" class="muted">Caricamento partita‚Ä¶</div>

  <div class="row">
    <label><b>Inserisci marcatori (facoltativo)</b></label>
    <textarea id="scorersText" placeholder="Es. Marco 2, Luca 1"></textarea>
  </div>

  <button id="saveBtn">üíæ Salva</button>

  <div id="msg"></div>
</div>

<script src="config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
const info = document.getElementById("info");
const msg  = document.getElementById("msg");
const textarea = document.getElementById("scorersText");
const btn = document.getElementById("saveBtn");

if(!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY){
  info.textContent = "Config mancante (config.js)";
  throw new Error("Missing config");
}

const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let CURRENT_MATCH_ID = null;

async function loadLastMatch(){
  const { data, error } = await client
    .from("matches")
    .select("id,match_date,match_time,score_a,score_b,scorers_text")
    .order("match_date",{ascending:false})
    .order("match_time",{ascending:false})
    .limit(1)
    .single();

  if(error || !data){
    info.textContent = "Nessuna partita trovata.";
    return;
  }

  CURRENT_MATCH_ID = data.id;

  info.innerHTML = `
    <div class="badge">${data.match_date}</div>
    <div class="badge">${data.score_a} - ${data.score_b}</div>
  `;

  textarea.value = data.scorers_text || "";
}

btn.onclick = async ()=>{
  if(!CURRENT_MATCH_ID) return;

  const text = textarea.value.trim();

  const { error } = await client
    .from("matches")
    .update({ scorers_text: text || null })
    .eq("id", CURRENT_MATCH_ID);

  if(error){
    msg.innerHTML = `<div class="err">Errore: ${error.message}</div>`;
  }else{
    msg.innerHTML = `<div class="ok">‚úÖ Marcatori salvati</div>`;
  }
};

loadLastMatch();
</script>

</body>
</html>
